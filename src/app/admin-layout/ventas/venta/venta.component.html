<div class="contenedor_contenido">
  <div class="header">
    <h1 class="color-blanco cliente-titulo">Nueva Venta</h1>
  </div>

  <div class="pos-page">
    <section class="pos-left">
      <div class="pos-title-row">
        <h2 class="subtitulo color-blanco">Punto de Venta</h2>
      </div>

      <div class="search-row">
        <label class="label color-blanco">Productos</label>
        <input class="input" type="text" placeholder="Ingrese el cÃ³digo de barras o el nombre del producto"
          [value]="search()" (input)="search.set(($any($event.target).value))" />
      </div>

      <div class="total-row">
        <div class="total-big color-blanco">Total Venta: Q {{ getTotalGeneralTemp() }}</div>

        <div class="actions-row">
          <button class="btn btn-primary" type="button" (click)="realizarVenta()">
            ðŸ›’ Realizar Venta
          </button>
          <button class="btn btn-danger" type="button" (click)="vaciarListado()">
            ðŸ—‘ Vaciar Listado
          </button>
        </div>
      </div>

      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>CÃ³digo</th>
              <th>Producto</th>
              <th>Cantidad</th>
              <th>Precio</th>
              <th>subtotal</th>
              <th>IVA</th>
              <th>Total</th>
              <th>OpciÃ³n</th>
            </tr>
          </thead>

          <tbody>
            @for (it of cart; track it.product.code; let i = $index) {
            <tr class="color-blanco">
              <td>{{ it.product.code }}</td>
              <td>{{ it.product.productName }}</td>

              <td class="center">
                <div class="qty">
                  <button type="button" class="icon-btn" (click)="decQty(i)">âˆ’</button>
                  <span>{{ it.qty }} Und(s)</span>
                  <button type="button" class="icon-btn" (click)="incQty(i)">+</button>
                </div>
              </td>

              <td class="right">Q {{ it.product.price.toFixed(2) }}</td>
              <td class="right">Q {{ calcSubtotal(it) }}</td>
              <td class="right">Q {{ calcIva(it) }}</td>
              <td class="right">Q {{ calcTotal(it) }}</td>

              <td class="center">
                <button class="mini-btn danger" type="button" title="Eliminar" (click)="remove(i)">ðŸ—‘</button>
              </td>
            </tr>
            } @empty {
            <tr>
              <td colspan="8" class="empty">No hay productos en el listado.</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </section>

    <!-- DERECHA -->
    <aside class="pos-right">
      <div class="card">
        <div class="card-header">
          Total Venta: Q {{ getTotalGeneralTemp() }}
        </div>

        <div class="card-body">
          <div class="field">
            <label class="color-blanco">Documento <span class="danger">*</span></label>
            <select class="select" [value]="docType()" (change)="docType.set($any($event.target).value)">
              <option class="option">Boleta</option>
              <option class="option">Factura</option>
            </select>
          </div>

          <div class="field">
            <label class="color-blanco">Tipo Pago <span class="danger">*</span></label>
            <select class="select" [value]="payType()" (change)="payType.set($any($event.target).value)">
              <option class="option">Efectivo</option>
              <option class="option">Tarjeta</option>
              <option class="option">Transferencia</option>
            </select>
          </div>

          <div class="two-cols">
            <div class="field">
              <label class="color-blanco">Serie</label>
              <input class="input" [value]="serie()" (input)="serie.set($any($event.target).value)" />
            </div>

            <div class="field">
              <label class="color-blanco">Nro Venta</label>
              <input class="input" [value]="nroVenta()" (input)="nroVenta.set($any($event.target).value)" />
            </div>
          </div>

          @if (payType() === 'Efectivo') {
          <div class="field">
            <label class="color-blanco">Efectivo recibido</label>
            @if (efectivoExacto()) {
            <input class="input" type="number" [value]="getTotalGeneralTemp()" />
            }
            @else {
            <input class="input" type="number" [value]="efectivoRecibido()"
              (input)="efectivoRecibido.set(+$any($event.target).value)" />
            }

          </div>

          <label class="check color-blanco">
            <input type="checkbox" [checked]="efectivoExacto()"
              (change)="setEfectivoExacto($any($event.target).checked)" />
            Efectivo Exacto
          </label>

          <div class="money-line">
            <div class="money-label red">Vuelto:</div>
            <div class="money-value red">Q {{ vuelto().toFixed(2) }}</div>
          </div>

          @if (faltante() > 0) {
          <div class="money-line">
            <div class="money-label red">Faltante:</div>
            <div class="money-value red">Q {{ faltante().toFixed(2) }}</div>
          </div>
          }
          }

          <div class="totals">
            <div class="tot-row color-blanco">
              <span>SUBTOTAL</span>
              <strong>Q {{ getSubtotalGeneralTemp() }}</strong>
            </div>
            <div class="tot-row color-blanco">
              <span>IGV (5%)</span>
              <strong>Q {{ getIvaGeneralTemp() }}</strong>
            </div>
            <div class="tot-row total color-blanco">
              <span>TOTAL</span>
              <strong>Q {{ getTotalGeneralTemp() }}</strong>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </div>
</div>